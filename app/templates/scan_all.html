<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Blockchain Integrity Audit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">


  <style>
    :root {
      --cs-bg: #f8fafc;
      --cs-surface: #ffffff;
      --cs-border: #e5e7eb;

      --cs-primary: #1e3a8a;
      --cs-primary-light: #3b82f6;

      --cs-text: #0f172a;
      --cs-muted: #64748b;

      --cs-success: #16a34a;
      --cs-danger: #dc2626;
    }

    body {
      background: var(--cs-bg);
      font-family: "Inter", system-ui;
      color: var(--cs-text);
    }

    .audit-header h3 {
  font-weight: 600;
}

.audit-header {
  padding-bottom: 1rem;
  border-bottom: 1px dashed #e5e7eb;
}


    /* Navbar â€“ keep old layout, new look */
    .navbar {
      background: var(--cs-primary);
      box-shadow: 0 8px 24px rgba(30, 58, 138, 0.35);
    }

    .navbar-brand {
      color: #fff !important;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    /* Card */
    .card {
      background: rgba(255,255,255,0.95);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.4);
      box-shadow:
        0 20px 40px rgba(15,23,42,0.08),
        inset 0 1px 0 rgba(255,255,255,0.6);
    }


    h3 {
      font-weight: 600;
    }

    /* Table */
    .table thead th {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #64748b;
      border-bottom: 1px solid #e5e7eb;
    }

    .table tbody tr {
      background: #ffffff;
      border-radius: 14px;
      box-shadow: 0 6px 14px rgba(15,23,42,0.06);
    }

.table tbody tr:hover {
      transform: scale(1.005);
      box-shadow: 0 14px 32px rgba(15,23,42,0.12);
    }

    .table td {
      vertical-align: middle;
    }

    /* Badges */
    .badge {
      border-radius: 999px;
      padding: 0.45em 0.75em;
      font-weight: 500;
    }

    .bg-success {
      background: linear-gradient(
        135deg,
        rgba(34,197,94,0.18),
        rgba(16,185,129,0.18)
      ) !important;
      color: #065f46;
    }

    .bg-danger {
      background: linear-gradient(
        135deg,
        rgba(239,68,68,0.18),
        rgba(220,38,38,0.18)
      ) !important;
      color: #7f1d1d;
    }


    /* Hash code */
    code {
      background: #eef2ff;
      color: #1e3a8a;
      padding: 0.3rem 0.5rem;
      border-radius: 8px;
      font-size: 0.8rem;
    }


    footer {
      color: var(--cs-muted);
      font-size: 0.85rem;
    }
    .scan-summary strong {
  font-size: 1.4rem;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
.chain-loader {
  display: flex;
  gap: 8px;
  justify-content: center;
}

/* Each chain link */
.chain-loader span {
  width: 18px;
  height: 10px;
  border: 3px solid #2563eb;
  border-radius: 12px;
  position: relative;
  animation: chainMove 1.2s ease-in-out infinite;
  opacity: 0.4;
}

/* Staggered animation */
.chain-loader span:nth-child(1) { animation-delay: 0s; }
.chain-loader span:nth-child(2) { animation-delay: 0.15s; }
.chain-loader span:nth-child(3) { animation-delay: 0.3s; }
.chain-loader span:nth-child(4) { animation-delay: 0.45s; }

/* Animation */
@keyframes chainMove {
  0% {
    transform: translateY(0);
    opacity: 0.4;
  }
  50% {
    transform: translateY(-6px);
    opacity: 1;
  }
  100% {
    transform: translateY(0);
    opacity: 0.4;
  }
}
  </style>
</head>

<body>
<!-- ===== Chain Loader ===== -->
<div id="pageLoader" style="
  position: fixed;
  inset: 0;
  background: rgba(248,250,252,0.92);
  backdrop-filter: blur(6px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
">

  <div style="text-align:center;">

    <div class="chain-loader">
      <span></span>
      <span></span>
      <span></span>
      <span></span>
    </div>

    <div style="
      margin-top: 0.9rem;
      font-size: 0.75rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: #475569;
    ">
      Strengthning Chains
    </div>

  </div>

</div>


<!-- ðŸ”¹ Navbar -->
{% include "_header.html" %}

<!-- ðŸ”¹ Main Card -->
<div class="container mt-4">
  <div class="card p-4">

    <div class="audit-header text-center mb-4">
      <h3 class="mb-1">Blockchain Integrity Audit</h3>
      <p class="text-muted mb-0">
         Verifying on-chain hashes against local records
      </p>
    </div>
    
    <div class="scan-summary d-flex justify-content-center gap-4 mb-4">
  <div class="text-success">
    <strong>{{ rows | selectattr("tamper_ok") | list | length }}</strong>
    <div class="small">Verified</div>
  </div>
  <div class="text-danger">
    <strong>{{ rows | rejectattr("tamper_ok") | list | length }}</strong>
    <div class="small">Tampered</div>
  </div>
</div>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Product ID</th>
            <th>Name</th>
            <th>Status</th>
            <th>Local Hash</th>
            <th>On-Chain Hash</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr>
            <td>{{ r.product.product_id }}</td>
            <td>{{ r.product.name }}</td>
            <td>
              {% if r.tamper_ok %}
                <span class="badge bg-success">Verified</span>
              {% else %}
                <span class="badge bg-danger">Tampered</span>
              {% endif %}
            </td>
            <td><code>{{ r.local_hash[:16] }}â€¦</code></td>
            <td><code>{{ r.onchain_hash[:16] }}â€¦</code></td>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" class="text-center text-muted">
              No products to scan.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>

<footer class="text-center mt-4">
  Â© 2025 Blockchain Supply Chain Â· Integrity Verified via Web3
</footer>
<script>
  const loader = document.getElementById("pageLoader");

  // Show loader on internal navigation
  document.addEventListener("click", function (e) {
    const link = e.target.closest("a");
    if (!link) return;

    const href = link.getAttribute("href");

    // Ignore empty, anchors, external, new tabs
    if (
      !href ||
      href.startsWith("#") ||
      href.startsWith("http") ||
      link.target === "_blank"
    ) return;

    loader.style.display = "flex";
  });

  // Hide loader when page finishes loading
  window.addEventListener("load", function () {
    loader.style.display = "none";
  });
</script>

</body>
</html>
